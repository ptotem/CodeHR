<style>
    #sortable {
        list-style-type: none;
        margin: 0;
        padding: 0;
    }

    #sortable li {
        font-size: 1.2em;
    }

    #sortable li span {
        position: absolute;
        margin-left: -1.3em;
    }

    .custom-control-label{
        float: left;
        text-align: left;
        padding-top: 5px;
        text-align: left;
        width: 160px;
    }

    .children_steps{
        display: none;
    }

    input[type="checkbox"], input[type="radio"] {
        opacity: 1;
    }

    .chzn-select{
        /*opacity: 1;*/
        /*visibility: visible;*/
        /*z-index: 1;*/
    }

    .date-time-selections {
        width: 30%;
    }

</style>
<%= include_gon %>
<%= nested_form_for(@process_master, html: {class: "form-horizontal"}) do |f| %>
    <% if @process_master.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@process_master.errors.count, "error") %> prohibited this process_master from being saved:</h2>

          <ul>
            <% @process_master.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
    <% end %>

    <div class="row-fluid">
      <div class="span6">
        <div class="control-group">
          <%= f.label :name, :class => "control-label" %>
          <div class="controls">
            <%= f.text_field :name %>
          </div>
        </div>
      </div>
    </div>

    <div class="row-fluid" id="start_nesting_step_master">
    <div class="span12">
    <div class="tabbable tabs-left">
    <ul class="nav nav-tabs" id="sortable">
      <li class="active"><a data-toggle="tab" href="#step1">Step 1</a></li>
    </ul>
    <div class="tab-content">
    <div id="step1" class="tab-pane in active">
    <%= f.fields_for :step_masters do |step_master| %>
        <div class="row-fluid">
          <!--<div class="span6">-->
            <!--<div class="control-group">-->
              <!--<label class="control-label">Link to previous step?</label>-->
              <!--<div class="controls">-->
                <!--<%#= check_box_tag 'previous_step', 'no', false, class: 'children-steps-control', :onchange=>"bind_children_steps_control($(this));" %>-->
              <!--</div>-->
            <!--</div>-->
          <!--</div>-->
          <div class="span6">
            <div class="control-group">
              <label class="control-label">Step Name</label>
              <div class="controls">
                <%= step_master.text_field :name, :class=>"step_masters_name_text_fields" %>
                <%= step_master.hidden_field :sequence, :class=>"my_seq" %>
              </div>
            </div>
          </div>
        </div>

        <div class="row-fluid">
          <div class="span5">
            <div class="control-group">
              <label class="custom-control-label actions-tobe-performed-name">Action to be performed</label>
              <div class="controls">
                <%#= step_master.text_field :oaction %>
                <%= step_master.select :oaction,options_for_select(["Creation", "Updation", "Deletion", "Tagging", "Approval","Notify","Release"], disabled: "", :selected => step_master.object.oaction), {:class=>"my_cls"}, :onchange=>"bind_children_steps_control($(this));" %>
              </div>
            </div>
          </div>
          <div class="span1">
            <div class="control-group">
              <label class="custom-control-label">on</label>
            </div>
          </div>
          <div class="span5">
            <div class="control-group">
              <label class="custom-control-label">Object</label>
              <div class="controls">
                <% @models = Dir["#{Rails.root}/app/models/*.rb"].map{|i| i.sub('.rb','').sub("#{Rails.root}/app/models/","").underscore.camelize} %>
                <%= step_master.select :oclass, options_for_select(["","System"]+@models.collect{ |u| [u] }, :include_blank => "Select", :selected => step_master.object.oclass), {:class => "models-select"} %>
                <%#= step_master.text_field :content %>
              </div>
              <label class="custom-control-label">Content</label>
              <div class="controls">
                <%#= step_master.select :oclass, options_for_select(Mongoid.models.collect{ |u| [u] }, :include_blank => "Select"), {:class => "models-select", :onchange=>"display_objects($(this));"} %>
                <%= step_master.text_field :content %>
              </div>
            </div>
            <div class="control-group">
              <label class="control-label">To</label>
              <div class="controls">
                <%#= step_master.select :action_to, options_for_select(["","Admin","Manager"]+@models.collect{ |u| [u] }, :include_blank => "Select", :selected => step_master.object.action_to), {:class => "models-select"}, :onchange=>"display_objects($(this));" %>
                <%#= step_master.select :action_to, options_for_select([["Employee Master", "EmployeeMaster"], ["Group Master", "GroupMaster"], ["Role", "Role"], ["Vendor Master", "VendorMaster"]], :include_blank => "Select", :selected => step_master.object.action_to), {:class => "models-select"}, :onchange=>"display_objects($(this));" %>
                <%= step_master.select :action_to, options_for_select([["EmployeeMaster"], ["GroupMaster"], ["Role"], ["VendorMaster"]], :selected => step_master.object.action_to),{} ,{:class => "models-select",:onchange=>"display_objects($(this));"} %>
              </div>
            </div>
          </div>
        </div>

        <div class="row-fluid configurable" style="display: none;">
          <div class="span3">
            <label class="custom-control-label">Configurable</label>
            <%= step_master.check_box :configurable %>
          </div>
        </div>
        <br>

        <div class="row-fluid">
          <div class="span3" style="border: 1px solid #C5D0DC; padding: 1% 0% 0% 0%;">
            <!--<h4 style="padding-left: 2%;">Different Options</h4>-->
            <div class="row-fluid">
              <div class="span12">
                <div class="control-group">
                  <label class="custom-control-label" style="padding:0 0 0 4%;">
                    <%= radio_button_tag 'action_option', "single", false, :class => "action-input-radio", :onchange=>"select_single_obj($(this));" %><span class="lbl">Single Object</span>
                  </label>
                </div>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span12">
                <div class="control-group">
                  <label class="custom-control-label" style="padding:0 0 0 4%;">
                    <%= radio_button_tag 'action_option', "bulk", false, :class => "action-input-checkbox", :onchange=>"select_bulk_objs($(this));" %><span class="lbl">Bulk Objects</span>
                  </label>
                </div>
              </div>
            </div>
          </div>


          <!--<div class="row-fluid">-->
          <div class="span6">
            <div class="users-list_header table-header">Listing Objects</div>
            <h5 class="not-available-text">No objects available.</h5>
            <table class="users-list table table-striped table-bordered table-hover" style="display: none;">
              <tr>
                <th>Select Multiple</th>
                <th>Select Single</th>
                <th>Field 1</th>
                <th>Field 2</th>
              </tr>
              <tr>
              </tr>
            </table>
          </div>
          <!--</div>-->

        </div>
        <hr>
        <div class="row-fluid children_steps" style="margin-top: 2%;">
          <div class="span12">
            <div class="row-fluid">
              <div class="span2">
                <h5>Step 1a</h5>
              </div>
              <div class="span4">
                <h5><span class="nested_step_names">Step 1</span> - Approved</h5>
              </div>
              <div class="span6">
                <h5 class="goto_step" style="float: left; padding-right: 5px; position: relative; top: -5px;">Goto Step</h5>
                <%= step_master.select :approved_next_step, options_for_select([""], ""), :class=> 'steps_list' %>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span2">
                <h5>Step 1b</h5>
              </div>
              <div class="span4">
                <h5><span class="nested_step_names">Step 1</span> - Rejected</h5>
              </div>
              <div class="span6">
                <h5 class="goto_step" style="float: left; padding-right: 5px; position: relative; top: -5px;">Goto Step</h5>
                <%= step_master.select :reject_next_step, options_for_select([""], ""), :class=>'steps_list' %>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span2">
                <h5>Step 1c</h5>
              </div>
              <div class="span8">
                <h5><span class="nested_step_names">Step 1</span> - Pending</h5>
                <div class="row-fluid">
                  <div class="span12">
                    <table class="table table-striped table-bordered table-hover">
                      <tbody>
                      <thead>
                      <tr>
                        <th>Select</th>
                        <th>Action</th>
                        <th class="dependent_on_select" style="text-align: center;">Postfix <br>d:day / h:hour/ m:minute</th>
                        <th>Repeat</th>
                        <th style="text-align: center;">Postfix <br>d:day / h:hour/ m:minute</th>
                      </tr>
                      </thead>
                      </tbody>
                      <tr>
                        <td style="width: 12%">
                          <%= check_box_tag 'reminder', 'yes', false, class: 'select_what_options', :onchange=>"toggle_rea_options($(this));" %>
                        </td>
                        <td>Reminder?</td>
                        <td class="date-time-selections" style="text-align: center;">
                          <%= step_master.text_field :reminder , placeholder: 'Reminder', disabled: true %>
                        </td>
                        <td>
                          <%= check_box_tag 'repeat', 'yes', false, class: 'repeat_options', :onchange=>"toggle_repeat_r_options($(this));" %>
                        </td>
                        <td class="repeat-date-time-selections" style="text-align: center;">
                          <%= step_master.text_field :rep_reminder , placeholder: 'Repeat Reminder', disabled: true %>
                        </td>
                      </tr>
                      <tr>
                        <td style="width: 12%">
                          <%= check_box_tag 'escalate', 'yes', false, class: 'select_what_options', :onchange=>"toggle_rea_options($(this));" %>
                        </td>
                        <td>Escalate?</td>
                        <td class="date-time-selections" style="text-align: center;">
                          <%= step_master.text_field :escalate , placeholder: 'Escalate', disabled: true %>
                        </td>
                        <td>
                          <%#= check_box_tag 'repeat', 'yes', false, class: 'repeat_options', :onchange=>"toggle_rea_options($(this));" %>
                        </td>
                        <td class="escalate-date-time-selections" style="text-align: center;">
                          <%#= step_master.text_field :rep_escalate , placeholder: 'Repeat Escalate', disabled: true %>
                        </td>
                      </tr>
                      <tr>
                        <td style="width: 12%">
                          <%= check_box_tag 'auto_assign', 'yes', false, class: 'select_what_options', :onchange=>"toggle_rea_options($(this));" %>
                        </td>
                        <td>Auto Assign?</td>
                        <td class="date-time-selections" style="text-align: center;">
                          <%= step_master.text_field :auto_assign , placeholder: 'Auto Assign', disabled: true %>
                        </td>
                        <td>
                          <h5>to</h5>
                        </td>
                        <td style="text-align: center;">
                          <table style="width: 100%;">
                            <tr>
                              <td style="border-left: none; text-align: center;">
                                <%= radio_button_tag 'auto_assign_to_obj', "single", true, :class => "auto_assign_to_single_obj", :onchange=>"auto_assign_to_single_obj($(this));" %><span class="lbl">Single</span>
                              </td>
                              <td style="border-left: none;">
                                <%= radio_button_tag 'auto_assign_to_obj', "bulk", true, :class => "auto_assign_to_bulk_objs", :onchange=>"auto_assign_to_bulk_objs($(this));" %><span class="lbl">Bulk</span>
                              </td>
                            </tr>
                          </table>


                          <%#= select_tag "auto_assign_to", options_for_select(["","System"]+@models.collect{ |u| [u] }, :include_blank => "Select"), {class: 'auto_assign_tos', :onchange=>"nested_display_objects($(this));"} %>
                          <%= select_tag "auto_assign_to", options_for_select([["Employee Master", "EmployeeMaster"], ["Group Master", "GroupMaster"], ["Role", "Role"], ["Vendor Master", "VendorMaster"]], :include_blank => "Select"), {class: 'auto_assign_tos', :onchange=>"nested_display_objects($(this));"} %>

                          <br><hr>
                          <div class="span11">
                            <div id="auto_assign_to_header" class="table-header">Listing Objects</div>
                            <h5 class="auto_assign_to_text">No objects available.</h5>
                            <table class="auto_assign_to_list" class="table table-striped table-bordered table-hover">
                              <tr>
                                <th>Select Multiple</th>
                                <th>Select Single</th>
                                <th>Field 1</th>
                                <th>Field 2</th>
                              </tr>
                              <tr>
                                <!--<td><%#= check_box_tag 'select_obj_1', 'no', false, class: 'select_bulk_objects' %></td>-->
                                <!--<td><%#= radio_button_tag 'radio_obj_1', "single", false, :class => "select_single_objects", style:"position: relative; top: 0px; opacity: 1;" %></td>-->
                                <!--<td>User 1 Name</td>-->
                                <!--<td>User 1 Email</td>-->
                              </tr>
                            </table>
                          </div>

                        </td>
                      </tr>
                    </table>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <%= step_master.link_to_remove "Remove this record", :onClick=>"remove_tab_li($(this));" %>

    <% end %>
    </div>
    </div>
    </div>
    <%= f.link_to_add "Add new record", :step_masters %>


    </div>
    </div>
    <br>

    <div class="actions">
      <%= f.submit @form_config[:submit], :class=>"btn btn-info" %>
    </div>

<% end %>

<script type="text/javascript" src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script type="text/javascript" src="/assets/jquery.mjs.nestedSortable.js"></script>

<!--<link rel="stylesheet" href="/assets/chosen.css" />-->
<!--<script type="text/javascript" src="/assets/chosen.jquery.min.js"></script>-->


<script src="/assets/bootstrap-datepicker.min.js"></script>
<script type="text/javascript" src="/assets/bootstrap-timepicker.min.js"></script>
<!--<script>jQuery.noConflict();</script>-->
<link rel="stylesheet" href="/assets/bootstrap-timepicker.css" />

<%= javascript_include_tag "jquery.dataTables.min" %>
<%= javascript_include_tag "jquery.dataTables.bootstrap" %>
<%= javascript_include_tag "custom_dataTable" %>


<script>
    var nested_form_name_text_fields_len, this_step_name;
    var action_arr_index=0;
    var count = 0;
    $(function() {
        //console.log(gon.step_masters)
        //load_bindings();
        $('.date-picker').datepicker();

        $('.timepicker').timepicker({
            minuteStep: 1,
            showSeconds: false,
            showMeridian: false
        });

        $('body').on('click', function(){
            $('.date-picker').show();
            $('.timepicker').show();
            $('.bootstrap-timepicker-widget .dropdown-menu.open').css('left','180px');
        });

        //$(".chzn-select").chosen();
        //$(".chzn-select-deselect").chosen({allow_single_deselect:true});

        var seq_val, this_li_a;
        $("#sortable").sortable({stop: function(event,ui){
            //alert("done")
            //console.log($(ui.item).index());
            $('#sortable').find('li').each(function(i,v){
                var chandu =$(v).find('a').attr('href');
                $(chandu).find('.my_seq').val($(v).index());
            });

        }
        });  //nested form's fields (step_master -> steps) sortable

        $('.control-label').css('text-align','left');
        $(':checkbox').css('opacity','1');
        //$(':radio').css('opacity','1');

        //$('.children_steps').find('table').find('input[type=text]').css('width','40px');

        $('.bootstrap-timepicker-widget .dropdown-menu.open').css('left','180px');

        //load_bindings();


        //newly added newsted fields in tabbable
        $('a.add_nested_fields').on('click', function(){
            count=count+1;
            nested_form_name_text_fields_len = $("#start_nesting_step_master").find(".step_masters_name_text_fields").length + 1; //get number of name text fields in nested form (step_master)

            var sortable_lis = $('#sortable').find('li').length + 1;
            $('#sortable').find('li').removeClass('active');
            var ht = '<li class="active">' +
                    //'<a data-toggle="tab" href=#step'+nested_form_name_text_fields_len+'>' + "Step "+nested_form_name_text_fields_len + '</a>' +
                    '<a data-toggle="tab" href=#step'+ sortable_lis +'>' + "Step "+ sortable_lis + '</a>' +
                    '</li>'; //html for tab list (Step 1, Step 2, etc...).

            $("#sortable").append(ht); //add tab in list of steps

            //$(this).prev().find('.tab-content').find("#step"+nested_form_name_text_fields_len).find('.control-label').first().text("");
            //$(this).prev().find('.tab-content').find("#step"+nested_form_name_text_fields_len).find('.control-label').first().text("Step " + nested_form_name_text_fields_len);  //change label of step_master's name field acc. to sequence

            //using nested_form's prototype which gets the html of of newly added nested field
            window.NestedFormEvents.prototype.insertFields = function(content, assoc, link) {
                //l =  $(content).find(".control-label").first().text("Step " + nested_form_name_text_fields_len);
                l =  $(content).find(".control-label").first().text("Step Name");
                //$(content).append(l)

                var p = $(content).find(".control-label").parent().parent().parent().parent().attr('class');
                var last_child = $('.'+p).children().last().attr('onClick',"remove_tab_li($(this))");

                //$(content).append(last_child)

                var content_html = $(content).html();

                var $tr = $(link).prev().find('.tab-content').find(".tab-pane:last-child"); //get last added tab
                $('.tab-content').find('.tab-pane').removeClass('in active');
                //var c =  $(content).insertAfter($tr).wrap('<div id=step'+nested_form_name_text_fields_len+' class="tab-pane in active">'); //insert new nested form in tab after last tab
                var c =  $(content).insertAfter($tr).wrap('<div id=step'+sortable_lis+' class="tab-pane in active">'); //insert new nested form in tab after last tab
                //c.find(".control-label").remove();
                //return c.append(l);
                return c;
                //return $tr.append(content);
            }


            setTimeout(function(){
                //$('.tab-content').find('.tab-pane:not(:first-child)').css('position','relative');
                //$('form').css('position','relative');
                //$('.tab-content').find('.tab-pane:not(:first-child)').find('.fields :last-child').css({'position':'absolute', 'top':'16px', 'text-align':'left'});
                //$(".control-label :last-child")
                //$( "div span:last-child" )

                seq_arr = [];
                $('#sortable').find('li').each(function(i,v){
                    var chandu = $(v).find('a').attr('href').split('#')[1];
                    var this_tab_id = $('.tab-content').find('#'+chandu);
                    $(this_tab_id).find('.my_seq').val($(v).index());
                    seq_arr.push($(this_tab_id).find('.my_seq').val($(v).index()));
                    //console.log(seq_arr[i]);
                });

                step_values = [];
                seq_values = [];
                var par_tab;
                var par_tab_seq;
                $("#sortable").children().each(function(index,ele){
                    //if(!$(ele).hasClass("active"))
                      step_values.push($(ele).children().text());
                      par_tab = $(ele).children().attr('href').split("#")[1];
                      par_tab_seq = $('#'+par_tab).find('.my_seq').val();
                      //console.log(par_tab_seq)
                      seq_values.push(par_tab_seq);
                });


                for(var i =0;i<step_values.length;i++)
                {
                    $("#step"+(i+1)).find(".goto_step").each(function(index,ele){
                        var this_tab_seq = $("#step"+(i+1)).find('.my_seq').val();
                        //console.log(this_tab_seq);
                        $(ele).next().html("");
                        for(var j =0;j<step_values.length;j++)
                        {
                            if(step_values[i]!=step_values[j]){
                                //console.log(seq_arr[i]);
                                //$(ele).next().append("<option value="+[j+1]+">"+step_values[j]+"</option>");
                                $(ele).next().append("<option value="+seq_values[j]+">"+step_values[j]+"</option>");
                            }
                        }
                    });
                }


            },2000);


        });


        //view settings for edit form
        var form_id = $('.form-horizontal').attr('id');
        var form_act = form_id.split("_")[0];

        //execute this code in edit mode
        if (form_act == "edit"){

            var parent_tab = [];
            $('.tab-content').find('.my_seq').each(function(index,elem){
                parent_tab.push($(elem).parent().parent().parent().parent().parent().parent().attr('id'));
                //$(elem).val()
            });
            //alert(parent_tab);

            var $edit_fields, edit_fields_len;
            $edit_fields = $(".tab-content").find('.tab-pane').find(".fields");
            $('.tab-pane').empty().remove();
            $('.nav-tabs#sortable').empty();
            <%# @in=0 %>
            setTimeout(function(){
                $edit_fields.each(function(index,elem){
                    tab_list = '<li>' +
                            '<a data-toggle="tab" href=#step'+(index+1)+'>' + "Step "+(index+1)+ '</a>' +
                            '</li>';
                    $('.nav-tabs#sortable').append(tab_list);
                    //$("#routetype option[value='quietest']").attr("selected", "selected");
                    //$('.models-select')[index].
                    <%# if @process_master.step_masters[@in].action_arr %>
                    setTimeout(function(){
                        if(gon.step_masters[index].action_arr_masters != undefined){
                            //alert(gon.step_masters[index].action_arr_masters.first.a_obj_id)
                            display_objects($("#step"+(index+1)).find(".models-select"));
                           // console.log('sunny');
                            //$(".users-list").hide();
                            gon.step_masters[index].action_arr_masters.each(function(i,v){
                                $($("#step"+(index+1)).find('.user_select_checkbox[value="'+ i.a_obj_id+'"]')[0]).prop("checked", "checked")
                                console.log(i.a_obj_id)
                            });
                            $($(".users-list")[index]).show();
                        }
                    },1000);

                    var a="step"+(index+1);
                    $('.tab-content').append('<div id='+a+' class="tab-pane in active">'+$(elem).html()+'</div>');
                    <%# @in = @in +1 %>
                });
            },500)




            $('.tab-pane:not(:first)').hide();

            $("#sortable").find('li').on('click', function() {

                var this_li_child_href = $(this).children().attr('href');
                var lastChar = this_li_child_href.substr(this_li_child_href.length - 1); // => "1"
                var intlastChar;
                intlastChar = parseInt(lastChar);
                $('.tab-pane').hide();
                $("#step"+intlastChar).show();
            });
        }

    });

    function remove_tab_li(this_obj){

        var sortable_lis = $('#sortable').find('li').length;
        var tab_pane_id = $(this_obj).parent().parent().attr('id');
        //console.log($(this_obj));
        //console.log(tab_pane_id);
        //TODO: add/remove using sequence


        $('#sortable').children().find('a').each(function () {
            if ( $(this).attr('href') == "#"+tab_pane_id) {
                $(this).parent().prev().addClass('active');
                //$('.tab-content').find("#"+tab_pane_id).empty().remove();
                $('.tab-content').find("#"+tab_pane_id).prev().addClass('active');
                //console.log($(this).parent());
                //console.log($(this_obj).parent().parent());
                $(this).parent().empty().remove();
                $(this_obj).parent().parent().empty().remove();
            }
        });
        $('#sortable').find("li").each(function(index,ele){
            $(ele).children("a").text("Step "+parseInt(index+1))

        })  ;

        nested_form_name_text_fields_len = $("#start_nesting_step_master").find(".step_masters_name_text_fields").length; //get number of name text fields in nested form (step_master)
        //console.log(nested_form_name_text_fields_len);

    }

    function load_bindings(){

        $('.add-on').on('click', function(){
            $(this).prev().focus();
        });

    }

    function display_objects(this_obj){
        //alert("Sunny");
        //console.log($(this_obj).closest('.row-fluid'));
        console.log(this_obj)
        var parent_tab = $(this_obj).parent().parent().parent().parent().parent().parent();
        var model_name = $(this_obj).val();
        var step_name = $(this_obj).parents('.fields').find('.step_masters_name_text_fields').val();
        var data = {model_name: []};
        data["model_name"].push(model_name);
        //console.log(parent_tab);
        //console.log(model_name);
        $.ajax({
            url: "/get_column_data",
            type: "post",
            async: false,
            data: JSON.stringify(data),
            contentType: "application/json",
            success: function (data) {
                //console.log(data)
                //console.log("selected model : " + model_name);
                $(parent_tab).find('.users-list').show();
                $(parent_tab).find('.not-available-text').hide();
                var user_name, email;
                var user_name_td, email_td;
                var $user_row;
                var $checkbox_col = '<td style="position: relative;"><input type="checkbox" name="vehicle" value="Car" class="user_select_checkbox" style="position: relative; top: 0;"></td>';
                var $radio_button_col = '<td style="position: relative;"><input type="radio" name="sex" value="female" class="user_select_radio" style="position: relative; top: 0;"></td>';
                $(parent_tab).find(".users-list tr:not(:first-child)").empty();

                if ( model_name == "EmployeeMaster" ) {
                    for(var i= 0 ;i< data.length;i++)
                    {
                        my_id = data[i]["_id"];
                        $user_row = '<tr>'+
                                '<td style="position: relative;"><input type="checkbox" name="action_arr['+count+'][]" disabled value='+my_id+' class="user_select_checkbox" style="position: relative; top: 0;"></td>'+
                                '<td style="position: relative;"><input type="radio" name="action_arr" disabled value='+my_id+' class="user_select_radio" style="position: relative; top: 0;"></td>'+
                                '<td>'+data[i]["employee_name"]+'</td><td>'+data[i]["official_email"]+'</td></tr>';
                        $(parent_tab).find(".users-list").append($user_row);
                    }
                    $(parent_tab).find(".users-list").find("tr:first").find("th:last").show();
                }
                else if ( model_name == "GroupMaster" ) {
                    for(var i= 0 ;i< data.length;i++)
                    {
                        my_id = data[i]["_id"];
                        $user_row = '<tr>'+
                                '<td style="position: relative;"><input type="checkbox" name="action_arr['+count+'][]" disabled value='+my_id+' class="user_select_checkbox" style="position: relative; top: 0;"></td>'+
                                '<td style="position: relative;"><input type="radio" name="action_arr" disabled value='+my_id+' class="user_select_radio" style="position: relative; top: 0;"></td>'+
                                '<td>'+data[i]["group_name"]+'</td></tr>';
                        $(parent_tab).find(".users-list").append($user_row);
                    }
                    $(parent_tab).find(".users-list").find("tr:first").find("th:last").hide();
                }
                else if ( model_name == "Role" ) {
                    for(var i= 0 ;i< data.length;i++)
                    {
                        my_id = data[i]["_id"];
                        $user_row = '<tr>'+
                                '<td style="position: relative;"><input type="checkbox" name="action_arr['+count+'][]" disabled value='+my_id+' class="user_select_checkbox" style="position: relative; top: 0;"></td>'+
                                '<td style="position: relative;"><input type="radio" name="action_arr" disabled value='+my_id+' class="user_select_radio" style="position: relative; top: 0;"></td>'+
                                '<td>'+data[i]["name"]+'</td></tr>';
                        $(parent_tab).find(".users-list").append($user_row);
                    }
                    $(parent_tab).find(".users-list").find("tr:first").find("th:last").hide();
                }
                else if ( model_name == "VendorMaster" ) {
                    for(var i= 0 ;i< data.length;i++)
                    {
                        my_id = data[i]["_id"];
                        $user_row = '<tr>'+
                                '<td style="position: relative;"><input type="checkbox" name="action_arr['+count+'][]" disabled value='+my_id+' class="user_select_checkbox" style="position: relative; top: 0;"></td>'+
                                '<td style="position: relative;"><input type="radio" name="action_arr" disabled value='+my_id+' class="user_select_radio" style="position: relative; top: 0;"></td>'+
                                '<td>'+data[i]["vendor_name"]+'</td><td>'+data[i]["vendor_type"]+'</td></tr>';
                        $(parent_tab).find(".users-list").append($user_row);
                    }
                    $(parent_tab).find(".users-list").find("tr:first").find("th:last").show();
                }

                $(':checkbox, :radio').css('opacity','1');

                action_arr_index=action_arr_index+1;
            }
        });

    }


    function nested_display_objects(this_obj){
        //console.log($(this_obj).parent().find('.auto_assign_to_list').html());

        var table = $(this_obj).parent().find('.auto_assign_to_list');
        //$(table).empty();
        var model_name = $(this_obj).val();
        //console.log(model_name);

        //var step_name = $(this_obj).parents('.fields').find('.step_masters_name_text_fields').val();
        var data = {model_name: []};
        data["model_name"].push(model_name);

        $.ajax({
            url: "/get_column_data",
            type: "post",
            async: false,
            data: JSON.stringify(data),
            contentType: "application/json",
            success: function (data) {
                $(table).show();
                $(this_obj).parent().find('.auto_assign_to_text').hide();
                var user_name, email;
                var user_name_td, email_td;
                var $user_row;
                //var $checkbox_col = '<td><input type="checkbox" value="no" name="select_obj_1" id="select_obj_1" class="select_bulk_objects"></td>';
                //var $radio_button_col = '<td><input type="radio" value="single" style="position: relative; top: 0px; opacity: 1;" name="radio_obj_1" id="radio_obj_1_single" class="select_single_objects"></td>';
                //$(table+ "tr:not(:first-child)").empty();

                if ( model_name == "EmployeeMaster" ) {
                    for(var i= 0 ;i< data.length;i++)
                    {
                        my_id = data[i]["_id"];
                        $user_row = '<tr>'+
                                '<td><input type="checkbox" name="action_app_arr['+(count)+'][]" disabled value='+my_id+' class="select_bulk_objects"></td>'+
                                '<td><input type="radio" name="action_app_arr['+(count)+']" disabled value='+my_id+' class="select_single_objects" style="position: relative; top: 0;"></td>'+
                                '<td>'+data[i]["employee_name"]+'</td><td>'+data[i]["official_email"]+'</td></tr>';
                        $(table).append($user_row);
                    }
                    $(table).find("tr:first").find("th:last").show();
                }
                else if ( model_name == "GroupMaster" ) {
                    for(var i= 0 ;i< data.length;i++)
                    {
                        my_id = data[i]["_id"];
                        $user_row = '<tr>'+
                                '<td><input type="checkbox" name="action_app_arr['+(count)+'][]" disabled value='+my_id+' class="select_bulk_objects"></td>'+
                                '<td><input type="radio" name="action_app_arr['+(count)+']" disabled value='+my_id+' class="select_single_objects" style="position: relative; top: 0;"></td>'+
                                '<td>'+data[i]["group_name"]+'</td></tr>';
                        $(table).append($user_row);
                    }
                    $(table).find("tr:first").find("th:last").hide();
                }
                else if ( model_name == "Role" ) {
                    for(var i= 0 ;i< data.length;i++)
                    {
                        my_id = data[i]["_id"];
                        $user_row = '<tr>'+
                                '<td><input type="checkbox" name="action_app_arr['+(count)+'][]" disabled value='+my_id+' class="select_bulk_objects"></td>'+
                                '<td><input type="radio" name="action_app_arr['+(count)+']" disabled value='+my_id+' class="select_single_objects" style="position: relative; top: 0;"></td>'+
                                '<td>'+data[i]["name"]+'</td></tr>';
                        $(table).append($user_row);
                    }
                    $(table).find("tr:first").find("th:last").hide();
                }
                else if ( model_name == "VendorMaster" ) {
                    for(var i= 0 ;i< data.length;i++)
                    {
                        my_id = data[i]["_id"];
                        $user_row = '<tr>'+
                                '<td><input type="checkbox" name="action_app_arr['+(count)+'][]" disabled value='+my_id+' class="select_bulk_objects"></td>'+
                                '<td><input type="radio" name="action_app_arr['+(count)+']" disabled value='+my_id+' class="select_single_objects" style="position: relative; top: 0;"></td>'+
                                '<td>'+data[i]["vendor_name"]+'</td><td>'+data[i]["vendor_type"]+'</td></tr>';
                        $(table).append($user_row);
                    }
                    $(table).find("tr:first").find("th:last").show();
                }

                $(':checkbox, :radio').css('opacity','1');

                action_arr_index=action_arr_index+1;
            }
        });

    }

    function select_single_obj(this_obj){
        var this_checkboxes = $(this_obj).parent().parent().parent().parent().parent().parent().find('.users-list').find('.user_select_checkbox');
        var this_radio_btns = $(this_obj).parent().parent().parent().parent().parent().parent().find('.users-list').find('.user_select_radio');

        if( $(this_obj).is(":checked") ){
            $(this_checkboxes).attr("disabled", true);
            $(this_radio_btns).removeAttr("disabled");
        }
    }

    function select_bulk_objs(this_ob){

        var this_checkboxes = $(this_ob).parent().parent().parent().parent().parent().parent().find('.users-list').find('.user_select_checkbox');
        var this_radio_btns = $(this_ob).parent().parent().parent().parent().parent().parent().find('.users-list').find('.user_select_radio');

        if( $(this_ob).is(":checked") ){
            $(this_radio_btns).attr("disabled", true);
            $(this_checkboxes).removeAttr("disabled");
        }
    }

    function bind_children_steps_control(this_obj){
        //toggle children steps - starts

        var this_parent_tab = $(this_obj).parent().parent().parent().parent().parent().parent();
        var children_steps = $(this_parent_tab).find('.children_steps');
        var configurable_field = $(this_parent_tab).find('.configurable');


        //alert($(this_parent_tab).find('.actions-tobe-performed-name').next().children().attr('id'));

        if( ($(this_obj).val() == "Approval") && ( !$(this_parent_tab).index()==0 ) ) {
            $(children_steps).show();
            $(configurable_field).show();
            this_step_name = $(this_obj).parent().parent().parent().next().find('input[type=text]').val();
            $('.nested_step_names').text(this_step_name);
        }
        else{
            $(children_steps).hide();
            $(configurable_field).hide();
        }

//        if ($(this_obj).is(":checked"))
//        {
//            $(children_steps).show();
//            this_step_name = $(this_obj).parent().parent().parent().next().find('input[type=text]').val();
//            $('.nested_step_names').text(this_step_name);
//        }
//        else{
//            $(children_steps).hide();
//        }

        //toggle children steps - ends
    }

    function auto_assign_to_bulk_objs(this_obj){
        if( $(this_obj).is(":checked") ){
            $("input.select_single_objects").attr("disabled", true);
            $("input.select_single_objects").hide();
            $("input.select_bulk_objects").removeAttr("disabled");
            $("input.select_bulk_objects").show();
        }
    }

    function auto_assign_to_single_obj(this_obj){
        if( $(this_obj).is(":checked") ){
            $("input.select_bulk_objects").attr("disabled", true);
            $("input.select_bulk_objects").hide();
            $("input.select_single_objects").removeAttr("disabled");
            $("input.select_single_objects").show();
        }
    }


    function toggle_rea_options(this_obj){

        var next_adj_cell_tb = $(this_obj).parent().parent().find('td').eq(2).children();
        if ($(this_obj).is(":checked"))
        {
            $(next_adj_cell_tb).prop('disabled', false);
        }
        else{
            $(next_adj_cell_tb).prop('disabled', true);
        }
    }

    function toggle_repeat_r_options(this_obj){
        var next_adj_cell_tb = $(this_obj).parent().parent().find('td').eq(4).children();
        if ($(this_obj).is(":checked"))
        {
            $(next_adj_cell_tb).prop('disabled', false);
        }
        else{
            $(next_adj_cell_tb).prop('disabled', true);
        }
    }


</script>
