<style>
    #sortable {
        list-style-type: none;
        margin: 0;
        padding: 0;
    }

    #sortable li {
        font-size: 1.2em;
    }

    #sortable li span {
        position: absolute;
        margin-left: -1.3em;
    }

    .custom-control-label{
        float: left;
        text-align: left;
        padding-top: 5px;
        text-align: left;
        width: 160px;
    }

</style>
<%= nested_form_for(@process_master, html: {class: "form-horizontal"}) do |f| %>
  <% if @process_master.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@process_master.errors.count, "error") %> prohibited this process_master from being saved:</h2>

      <ul>
      <% @process_master.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

    <div class="row-fluid">
      <div class="span12">
        <div class="control-group">
          <%= f.label :name, :class => "control-label" %>
          <div class="controls">
            <%= f.text_field :name %>
          </div>
        </div>
      </div>
    </div>

    <div class="row-fluid" id="start_nesting_step_master">
      <div class="span12">


            <div class="tabbable tabs-left">
              <ul class="nav nav-tabs" id="sortable">
                <li class="active"><a data-toggle="tab" href="#step1">Step 1</a></li>
                <!--<li><a data-toggle="tab" href="#step2">Step 2</a></li>-->
              </ul>
              <div class="tab-content">
                <div id="step1" class="tab-pane in active">
                  <%= f.fields_for :step_masters do |step_master| %>
                      <div class="row-fluid">
                        <div class="span6">
                          <div class="control-group">
                            <%#= step_master.label :name, :class => "control-label" %>
                            <label class="control-label" style="position: relative; text-align: left; top: -100px;">Step 1</label>
                            <div class="controls">
                              <%= step_master.text_field :name, :class=>"step_masters_name_text_fields" %>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row-fluid">
                        <div class="span6">
                          <div class="control-group">
                            <%#= step_master.label :oclass, :class => "control-label" %>
                            <label class="custom-control-label">Class Name</label>
                            <div class="controls">
                              <%#= step_master.text_field :oclass %>
                              <%= select_tag 'oclass', options_for_select(Mongoid.models.collect{ |u| [u] }) %>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row-fluid">
                        <div class="span6">
                          <div class="control-group">
                            <%#= step_master.label :oclass, :class => "control-label" %>
                            <label class="custom-control-label">Action Name</label>
                            <div class="controls">
                              <%= step_master.text_field :oaction %>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row-fluid" style="border: 1px solid #C5D0DC;">
                        <div class="span6">
                          <h4>Different Options</h4>
                          <div class="control-group">
                            <label class="custom-control-label" style="text-align: right; padding-top:0;">Single</label>
                            <div class="controls">
                                <%#= check_box_tag 'Single', 'single' %>
                                <%= radio_button_tag 'action_option', "single", true, :class => "action_input" %>
                            </div>
                          </div>
                          <div class="control-group">
                            <label class="custom-control-label" style="text-align: right; padding-top:0;">Bulk</label>
                            <div class="controls">
                              <%#= check_box_tag 'Bulk', 'bulk' %>
                              <%= radio_button_tag 'action_option', "bulk", true, :class => "action_input" %>
                            </div>
                          </div>
                        </div>
                      </div>

                      <%= step_master.link_to_remove "Remove this task" %>

                  <% end %>
                </div>
              </div>
            </div>
        <%= f.link_to_add "Add New Step", :step_masters %>

        <div class="row-fluid">
          <div class="offset4 span6">
            <table id="users_list" border="1">
              <tr>
                <th>Check</th>
                <th>Radio</th>
                <th>User Name</th>
                <th>E-mail</th>
              </tr>
              <tr>
                <!--<td>Nilesh</td>-->
                <!--<td>nilesh@ptotem.com</td>-->
              </tr>
            </table>
          </div>
        </div>


      </div>
    </div>
    <br>
  <div class="actions">
    <%= f.submit %>
  </div>

<% end %>

<script type="text/javascript" src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script type="text/javascript" src="/assets/jquery.mjs.nestedSortable.js"></script>

<script>
    var nested_form_name_text_fields_len;

    $(function() {

        $("#sortable").sortable();  //nested form's fields (step_master -> steps) sortable

        $('.control-label').css('text-align','left');
        $(':checkbox, :radio').css('opacity','1');

//        $(".action_input").on('change', function(){
//            if( $(this).is(":checked") ){
//                var val = $(this).val();
//                //alert(val);
//            }
//        }); //checking value of single/bulk radio button

        $("#action_option_bulk").on('change', function(){
            if( $(this).is(":checked") ){
                $("input.user_select_radio").attr("disabled", true);
                $("input.user_select_radio").hide();
                $("input.user_select_checkbox").removeAttr("disabled");
                $("input.user_select_checkbox").show();
            }
        });

        $("#action_option_single").on('change', function(){
            if( $(this).is(":checked") ){
                $("input.user_select_checkbox").attr("disabled", true);
                $("input.user_select_checkbox").hide();
                $("input.user_select_radio").removeAttr("disabled");
                $("input.user_select_radio").show();
            }
        });

        //newly added newsted fields in tabbable
        $('a.add_nested_fields').on('click', function(){
            nested_form_name_text_fields_len = $("#start_nesting_step_master").find(".step_masters_name_text_fields").length + 1; //get number of name text fields in nested form (step_master)

            var ht = '<li>' +
                        '<a data-toggle="tab" href=#step'+nested_form_name_text_fields_len+'>' + "Step "+nested_form_name_text_fields_len + '</a>' +
                     '</li>'; //html for tab list (Step 1, Step 2, etc...).

            $("#sortable").append(ht); //add tab in list of steps

            $(this).prev().find('.tab-content').find("#step"+nested_form_name_text_fields_len).find('.control-label').text("");
            $(this).prev().find('.tab-content').find("#step"+nested_form_name_text_fields_len).find('.control-label').text("Step " + nested_form_name_text_fields_len);  //change label of step_master's name field acc. to sequence

            //using nested_form's prototype which gets the html of of newly added nested field
            window.NestedFormEvents.prototype.insertFields = function(content, assoc, link) {
                l =  $(content).find(".control-label").text("Step " + nested_form_name_text_fields_len);
                $(content).append(l)
                var content_html = $(content).html();

                var $tr = $(link).prev().find('.tab-content').find(".tab-pane:last-child"); //get last added tab
                var c =  $(content).insertAfter($tr).wrap('<div id=step'+nested_form_name_text_fields_len+' class="tab-pane">'); //insert new nested form in tab after last tab
                c.find(".control-label").remove();
                return c.append(l);
                //return $tr.append(content);
            }

            $('.control-label').css('text-align','left');

        });

        $('#oclass').on('change', function() {
            var model_name = $(this).val();

            var data = {model_name: []};
            data["model_name"].push(model_name);

            $.ajax({
                url: "/get_data",
                type: "post",
                async: false,
                data: JSON.stringify(data),
                contentType: "application/json",
                success: function (data) {
                    //alert(data);

                    var user_name, email;
                    var user_name_td, email_td;
                    var $user_row;
                    var $checkbox_col = '<td style="position: relative;"><input type="checkbox" name="vehicle" value="Car" class="user_select_checkbox" style="position: relative; top: 0;"></td>';
                    var $radio_button_col = '<td style="position: relative;"><input type="radio" name="sex" value="female" class="user_select_radio" style="position: relative; top: 0;"></td>';
                    //$("#users_list").empty();
                    $("#users_list tr:not(:first-child)").empty();
                    $.each(data.split(','), function (d, ele) {
                        ele = ele.toString().replace('[', '').replace(']', '').replace(/"/g, '');
                        user_name = ele.split('|')[0];
                        email = ele.split('|')[1];
                        $user_row = '<tr>'+$checkbox_col+$radio_button_col+'<td>'+user_name+'</td><td>'+email+'</td></tr>';
                        $("#users_list").append($user_row);
                    });
                    $(':checkbox, :radio').css('opacity','1');
                }
            });

        });

    });


</script>
