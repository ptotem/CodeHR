<style>
    #sortable {
        list-style-type: none;
        margin: 0;
        padding: 0;
        /*width: 60%;*/
    }

    #sortable li {
        /*margin: 0 3px 3px 3px;*/
        /*padding: 0.4em;*/
        /*padding-left: 1.5em;*/
        font-size: 1.2em;
        /*height: 18px;*/
    }

    #sortable li span {
        position: absolute;
        margin-left: -1.3em;
    }
</style>
<%= nested_form_for(@process_master, html: {class: "form-horizontal"}) do |f| %>
  <% if @process_master.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@process_master.errors.count, "error") %> prohibited this process_master from being saved:</h2>

      <ul>
      <% @process_master.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

    <div class="row-fluid">
      <div class="span12">
        <div class="control-group">
          <%= f.label :name, :class => "control-label" %>
          <div class="controls">
            <%= f.text_field :name %>
          </div>
        </div>
      </div>
    </div>

    <div class="row-fluid" id="start_nesting_step_master">
      <div class="span12">


            <div class="tabbable tabs-left">
              <ul class="nav nav-tabs" id="sortable">
                <li class="active"><a data-toggle="tab" href="#step1">Step 1</a></li>
                <!--<li><a data-toggle="tab" href="#step2">Step 2</a></li>-->
              </ul>
              <div class="tab-content">
                <div id="step1" class="tab-pane in active">
                  <%= f.fields_for :step_masters do |step_master| %>
                      <div class="row-fluid">
                        <div class="span6">
                          <div class="control-group">
                            <%#= step_master.label :name, :class => "control-label" %>
                            <label class="control-label" style="position: relative; text-align: left; top: -100px;">Step 1</label>
                            <div class="controls">
                              <%= step_master.text_field :name, :class=>"step_masters_name_text_fields" %>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row-fluid">
                        <div class="span6">
                          <div class="control-group">
                            <%#= step_master.label :oclass, :class => "control-label" %>
                            <label style="float: left; padding-top: 5px; text-align: left; width: 160px; text-align: left;">Class Name</label>
                            <div class="controls">
                              <%= step_master.text_field :oclass %>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row-fluid">
                        <div class="span6">
                          <div class="control-group">
                            <%#= step_master.label :oclass, :class => "control-label" %>
                            <label style="float: left; padding-top: 5px; text-align: left; width: 160px; text-align: left;">Action Name</label>
                            <div class="controls">
                              <%= step_master.text_field :oaction %>
                            </div>
                          </div>
                        </div>
                      </div>

                      <%= step_master.link_to_remove "Remove this task" %>

                  <% end %>
                </div>
              </div>
            </div>
        <%= f.link_to_add "Add New Step", :step_masters %>


      </div>
    </div>
    <br>
  <div class="actions">
    <%= f.submit %>
  </div>

<% end %>

<script type="text/javascript" src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script type="text/javascript" src="/assets/jquery.mjs.nestedSortable.js"></script>

<script>
    var nested_form_name_text_fields_len;

    $(function() {

        $("#sortable").sortable();

        $('.control-label').css('text-align','left');

        $('a.add_nested_fields').on('click', function(){
            nested_form_name_text_fields_len = $("#start_nesting_step_master").find(".step_masters_name_text_fields").length + 1;

            var ht = '<li>' +
                        '<a data-toggle="tab" href=#step'+nested_form_name_text_fields_len+'>' + "Step "+nested_form_name_text_fields_len + '</a>' +
                     '</li>';

            $("#sortable").append(ht);

            $(this).prev().find('.tab-content').find("#step"+nested_form_name_text_fields_len).find('.control-label').text("");
            $(this).prev().find('.tab-content').find("#step"+nested_form_name_text_fields_len).find('.control-label').text("Step " + nested_form_name_text_fields_len);

            window.NestedFormEvents.prototype.insertFields = function(content, assoc, link) {
                l =  $(content).find(".control-label").text("Step " + nested_form_name_text_fields_len);
                $(content).append(l)
                var content_html = $(content).html();

                var $tr = $(link).prev().find('.tab-content').find(".tab-pane:last-child");
                var c =  $(content).insertAfter($tr).wrap('<div id=step'+nested_form_name_text_fields_len+' class="tab-pane">');
                c.find(".control-label").remove();
                return c.append(l);
                //return $tr.append(content);
            }

            $('.control-label').css('text-align','left');

        })
    });


</script>
