<div class="row-fluid">
<%# PmsGroupCategoryMaster.all.each do |e| %>
      <% @goal.kras.build %>
<%# end %>
<%= nested_form_for(@goal,:url => review_form_path) do |f| %>
  <% if @goal.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@goal.errors.count, "error") %> prohibited this goal from being saved:</h2>

      <ul>
      <% @goal.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
    <div class="row-fluid">
      <div class="span6">
        <div class="control-group">
          <label for="Code" class="control-label">Code</label>
          <div class="controls">
            <%= f.text_field :code %>
          </div>
        </div>
      </div>
      <div class="span6">
        <div class="control-group">
          <label for="Name" class="control-label">Name</label>
          <div class="controls">
            <%= f.text_field :name %>
          </div>
        </div>
      </div>
    </div>
      <div class="row-fluid">
        <div class="span6">
          <div class="control-group">
            <label for="period_from" class="control-label">Period From  <sub>(dd-mm-yyyy)</sub>  </label>
            <div class="controls">
              <%#= f.date_select :date_of_birth %>
              <div class="row-fluid input-append date">
                <%= f.text_field :period_from, :class=>"span6 date-picker", :"data-date-format"=>"dd-mm-yyyy" %>
                <span class="add-on"><i class="icon-calendar"></i></span>
              </div>
            </div>
          </div>
        </div>
        <div class="span6">
          <div class="control-group">
            <label for="period_to" class="control-label">Period to  <sub>(dd-mm-yyyy)</sub>  </label>
            <div class="controls">
              <%#= f.date_select :date_of_birth %>
              <div class="row-fluid input-append date">
                <%= f.text_field :period_to, :class=>"span6 date-picker", :"data-date-format"=>"dd-mm-yyyy" %>
                <span class="add-on"><i class="icon-calendar"></i></span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span6">
          <div class="control-group">
            <label for="Parent">Parent</label>
            <%= f.select :parent_ids, options_from_collection_for_select(Goal.all, 'id', 'name'), {:include_blank => "Select"}, {:class => "chzn-select", :multiple=>true} %>
          </div>
        </div>
        <div class="span6">
          <div class="control-group">
            <label for="Parent">Goals For Level</label>
            <%= f.hidden_field :obj_class, :value => @level %>
            <%= f.select :object_id, options_from_collection_for_select(eval(@level).all, 'id', @sf), {:include_blank => "Select"}, {:class => "chzn-select", :multiple=>true} %>
          </div>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span12">
          <table class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
              <th></th>
              <th><label for="SCLabel" class="control-label">Code</label></th>
              <th><label for="Fixed" class="control-label">KRA</label></th>
              <th><label for="Fixed" class="control-label">KPI Value</label></th>
              <th><label for="Fixed" class="control-label">Incremental</label></th>
              <th><label for="Fixed" class="control-label">Unit</label></th>
              <th><label for="Fixed" class="control-label">Weightage</label></th>
              <th><label for="Fixed" class="control-label">Linked To Group</label></th>
              <th><label for="Fixed" class="control-label">Linked To KRA</label></th>
            </tr>
            </thead>
            <tbody>
            <%= f.fields_for :kras do |formula_lists| %>
                <tr class="salary_comp_row">
                  <td> <%= formula_lists.link_to_add "+", :subkras, :class =>"subkra_form" %></td>
                  <td><%= formula_lists.text_field :kra_code %></td>
                  <td><%= formula_lists.text_field :kra_name %></td>
                  <td><%= formula_lists.text_field :kpi_value %></td>
                  <td><%= formula_lists.text_field :incremental %></td>
                  <td><%= formula_lists.text_field :unit %></td>
                  <td><%= formula_lists.text_field :weightage %></td>
                  <td><%= formula_lists.select :linked_to_group, options_from_collection_for_select(EmployeeMaster.all, 'id', 'employee_name'), {:include_blank => "Select"}, {:class => "chzn-select", :multiple=>true} %></td>
                  <td><%= formula_lists.select :parent_ids, options_from_collection_for_select(Kra.all, 'id', 'kra_name'), {:include_blank => "Select"}, {:class => "chzn-select", :multiple=>true} %></td>

                <%= formula_lists.fields_for :subkras do |formula_list| %>
                    <tr>
                    <!--<td>&nbsp</td>-->
                    <td><%= formula_list.text_field :kra_code %></td>
                    <td><%= formula_list.text_field :kra_name %></td>
                    <td><%= formula_list.text_field :kpi_value %></td>
                    <td><%= formula_list.text_field :incremental %></td>
                    <td><%= formula_list.text_field :unit %></td>
                    <td><%= formula_list.text_field :weightage %></td>
                    <td><%= formula_list.select :linked_to_group, options_from_collection_for_select(EmployeeMaster.all, 'id', 'employee_name'), {:include_blank => "Select"}, {:class => "chzn-select", :multiple=>true} %></td>
                    <td><%= formula_list.select :parent_ids, options_from_collection_for_select(Kra.all, 'id', 'kra_name'), {:include_blank => "Select"}, {:class => "chzn-select", :multiple=>true} %></td>
                    </tr>
                <% end %>

                </tr>
            <% end %>
            <%= f.link_to_add "Add a Group Category", :kras, :class =>"kra_form" %>
            </tbody>
          </table>

        </div>
      </div>
      <%= hidden_field_tag :model_name , params[:model_name] %>
      <% if !params[:process_id].nil? %>
          <%= hidden_field_tag :process_id, params[:process_id] %>
          <%= hidden_field_tag :seq, params[:seq] %>
      <% end %>
      <div class="form-actions">
        <%#= f.submit :class=>"btn btn-info" %>
        <%= f.submit @form_config[:submit], :class=>"btn btn-info" %>
      </div>
<% end %>
</div>
<script type="text/javascript" src="/assets/chosen.jquery.min.js"></script>
<script type="text/javascript" src="/assets/bootstrap-datepicker.min.js"></script>

<script>
    $(function(){

//        $('a.kra_form').on('click', function(){
//            var oldNestedFormEvents = window.nestedFormEvents.insertFields
//            var new_content;
//            window.nestedFormEvents.insertFields = function (content, assoc, link) {
//                console.log(content)
//                console.log(link)
//                new_content = document.createElement('tr')
//                var wrapper;
//                $(content).children().each(function(i,v){
////                    if($(v).attr("type")!= "hidden") {
//                        wrapper = document.createElement('td');
//                        wrapper.appendChild(v);
//                        new_content.appendChild(wrapper);
//                        if (i >= $(content).children().length - 1)
//                            return $(new_content).insertAfter($('.table tr:last'));
////                    }
//                });
//                $(".chzn-select").chosen();
//                $(".chzn-select-deselect").chosen({allow_single_deselect:true});
//
//            }
//        });
////
//        $('a.subkra_form').on('click', function(){
//            var oldNestedFormEvents = window.nestedFormEvents.insertFields
//            var new_content;
//            window.nestedFormEvents.insertFields = function (content, assoc, link) {
//                console.log(content)
//                new_content = document.createElement('tr')
//                var wrapper;
//                $(content).children().each(function(i,v){
////                    if($(v).attr("type")!= "hidden") {
//                        wrapper = document.createElement('td');
//                        wrapper.appendChild(v);
//                        new_content.appendChild(wrapper);
//                        if (i >= $(content).children().length - 1)
//                            return $(new_content).insertAfter($('.table tr:last'));
////                    }
//                });
//                $(".chzn-select").chosen();
//                $(".chzn-select-deselect").chosen({allow_single_deselect:true});
//
//            }
//        });
    });
</script>