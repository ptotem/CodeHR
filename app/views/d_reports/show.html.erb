<div class="row-fluid">
  <div class="offset3 span6">
    <h1>Report: <%= @d_report.cl_name %></h1>
  </div>
</div>
<hr>



<div class="row-fluid">
  <div class="span12">

        <div class="table-header"><%=  @d_report.cl_name %></div>
        <table id="<%= @d_report.cl_name + "_table_"+ (0).to_s rescue "55"%>" class="dataTable table table-striped table-bordered table-hover">
          <thead>
          <tr>
            <% @d_report.cl_fields.each_with_index do |cf, index| %>
                <th id="<%= index %>"><%= cf %></th>
            <% end %>
          </tr>
          </thead>

          <tbody>
          <% @d_report.object_hash.each_with_index do |oh, index| %>
              <tr>
                <% oh.each_with_index do |h, index| %>
                    <td><%= h %></td>
                <% end %>
              </tr>
          <% end %>
          </tbody>
        </table>
        <br><br>

  </div>
</div>

<%= javascript_include_tag "jquery.dataTables.min" %>
<%= javascript_include_tag "jquery.dataTables.zbootstrap" %>


<script>
    $(function(){
        jQuery.fn.dataTable.Api.register( 'average()', function () {
            var i=0;
            var sum = this.flatten().reduce( function ( a, b ) {
                i++;
                return (a*1) + (b*1); // cast values in-case they are strings
            } );

            return sum / i;
        } );

        jQuery.fn.dataTable.Api.register( 'sum()', function () {

            var sum = this.flatten().reduce( function ( a, b ) {

                return (a*1) + (b*1); // cast values in-case they are strings
            } );

            return sum ;
        } );


        setTimeout(function(){

            x = $("#<%= @d_report.cl_name + "_table_"+ (0).to_s%>").DataTable().columns()[0].length
            var i = 0;
            for(i=0;i<x;i++)
            {
                existing_text =  $("#"+i).text();

                sum = parseInt($("#<%= @d_report.cl_name%>_table_0").DataTable().column(i).data().sum())
                avg = parseInt($("#<%= @d_report.cl_name%>_table_0").DataTable().column(i).data().average())
                $("#"+i).text( existing_text + "( "+sum +" , "+ avg+" )" );
            }},2000)


        $('.dataTable').dataTable();
    });
</script>
